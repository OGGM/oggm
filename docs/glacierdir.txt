.. currentmodule:: oggm

.. _glacierdir:

Glacier working directories
===========================

See also: :py:class:`~oggm.GlacierDirectory`

The majority of OGGM tasks are so-called "entity tasks". They
are standalone operations to be realized on one single glacier entity. These
tasks are executed sequentially: they often need input
generated by the previous task(s). In order to avoid complicated chains of
arguments, each task will read the input data from a glacier-specific
directory and writes its output into the same directory,
making the new data available for further computations.


Initalising a glacier directory
-------------------------------

.. ipython:: python
   :suppress:

    import os, shutil
    import numpy as np
    np.set_printoptions(threshold=10)
    import geopandas as gpd
    import oggm
    from oggm import cfg, tasks, graphics
    from oggm.utils import get_demo_file
    cfg.initialize()
    cfg.PARAMS['border'] = 20
    cfg.PATHS['dem_file'] = get_demo_file('hef_srtm.tif')
    path = os.path.join(os.path.expanduser('~'), 'OGGM_docs', 'GlacierDir')
    if os.path.exists(path):
        shutil.rmtree(path)

If no directory has been created yet, a GlacierDirectory requires an RGI entity
as input:

.. ipython:: python

    base_dir = os.path.join(os.path.expanduser('~'), 'OGGM_docs', 'GlacierDir')
    entity = gpd.GeoDataFrame.from_file(get_demo_file('HEF_MajDivide.shp')).iloc[0]
    gdir = oggm.GlacierDirectory(entity, base_dir=base_dir)
    gdir.dir
    gdir.rgi_id, gdir.rgi_area_km2

Note that this directory has just been created and is empty. The
:py:func:`tasks.define_glacier_region` will fill it with the first data files:

.. ipython:: python

    tasks.define_glacier_region(gdir, entity=entity)
    os.listdir(gdir.dir)

This persistence on disk allows for example to continue a workflow that has
been previously interrupted. Initialising a GlacierDirectory from a non-empty
folder won't erase its content (you'll have to set ``reset=True`` explicitly
if you want that):

.. ipython:: python

    gdir = oggm.GlacierDirectory(entity, base_dir=base_dir)
    os.listdir(gdir.dir)  # the directory still contains the data

You can also initialise a non-empty GlacierDirectory with its RGI ID, thus
sparing the reading of the shapefile every time:

.. ipython:: python

    gdir = oggm.GlacierDirectory('RGI50-11.00897', base_dir=base_dir)

.. _basenames:

cfg.BASENAMES
-------------

This is a list of the files that can be found in the glacier directory or
its divides. These data files and their names are standardized and listed in the
:py:mod:`oggm.cfg` module. If you want to implement your own task you'll
have to add an entry to this file too.

